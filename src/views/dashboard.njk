{% extends "layout.njk" %}

{% block title %}{{ title }} - Gerudo{% endblock %}

{% block content %}
<section class="dashboard">
  <div class="flex-between mb-lg">
    <h2>Your Dashboard</h2>
    <a href="#create-site" class="btn btn-primary">+ Create New Site</a>
  </div>

  {% if flash.success %}
    <div class="flash flash-success">
      ‚úì {{ flash.success }}
    </div>
  {% endif %}

  {% if flash.error %}
    <div class="flash flash-error">
      ‚úó {{ flash.error }}
    </div>
  {% endif %}

  <p class="text-muted">You currently own <strong>{{ totalSites }}</strong> site{% if totalSites != 1 %}s{% endif %}.</p>

  <section class="sites-list mt-lg">
    {% if sites.length > 0 %}
      <div class="sites-grid">
        {% for site in sites %}
          <div class="site-card">
            <div class="card-header">
              <h3 class="card-title">{{ site.title }}</h3>
            </div>
            <p class="site-slug">/{{ site.slug }}</p>
            <p class="text-muted small">
              Created: {{ site.created_at | date('short') }}
            </p>
            <div class="card-actions mt-md">
              <a href="/dashboard/site/{{ site.slug }}" class="btn btn-sm btn-secondary">View</a>
              <a href="/dashboard/edit-site/{{ site.id }}" class="btn btn-sm btn-secondary">Edit</a>
              <form method="POST" action="/dashboard/delete-site/{{ site.id }}" style="display:inline;" 
                    onsubmit="return confirm('Are you sure you want to delete this site?');">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">üìÅ</div>
        <p>You don't have any sites yet.</p>
        <p>Create your first site to get started!</p>
      </div>
    {% endif %}
  </section>
</section>

<!-- Create Site Modal -->
<div id="create-site" class="modal">
  <div class="modal-content">
    <a href="#" class="modal-close">&times;</a>
    <h3>Create a New Site</h3>
    <form method="POST" action="/dashboard/create-site" class="form">
      <div class="form-group">
        <label for="slug">Site Slug:</label>
        <input type="text" id="slug" name="slug" required 
               pattern="[a-z0-9-]+" 
               placeholder="my-awesome-site"
               title="Lowercase letters, numbers, and hyphens only">
        <small class="text-muted">This will be your site's URL: /{{ slug }}</small>
      </div>

      <div class="form-group">
        <label for="title">Site Title:</label>
        <input type="text" id="title" name="title" required
               maxlength="100"
               placeholder="My Awesome Site">
      </div>

      <button type="submit" class="btn btn-primary">Create Site</button>
    </form>
  </div>
</div>
{% endblock %}
